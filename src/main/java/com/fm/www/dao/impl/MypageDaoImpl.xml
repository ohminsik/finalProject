<?xml version="1.0" encoding="UTF-8"?>
<!-- 마이바티스 3 Mapper DOCTYPE -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!-- 매퍼 설정 -->
  <mapper namespace="com.fm.www.dao.face.MypageDao">
  	<!-- 유저가 가진 팀 넘버 가져오기 -->
  	<select id="getUserTeamNo" resultType="String" parameterType="com.fm.www.dto.User">
  		select team_no from user_tb
  		WHERE user_no = #{user_no}
  	</select>  
  
  	<!-- 팀생성 -->
  	<insert id="insertTeam" parameterType="com.fm.www.dto.Team">
  		INSERT INTO team_tb(team_no, team_name, team_cnt, team_region, team_age, team_type, team_level, team_uniform, team_field, team_mark, team_hello, team_YN)
  		VALUES(team_tb_SEQ.nextVal, #{team_name}, #{team_cnt}, #{team_region}, #{team_age}, #{team_type}, #{team_level}, #{team_uniform}, #{team_field}, #{team_mark}, #{team_hello}, #{team_YN})
  	</insert>
  	
  	<!-- 팀넘버 가져오기 -->
  	<select id="selectTeamNo" resultType="int" parameterType="com.fm.www.dto.Team">
  		SELECT team_no from team_tb
  		WHERE team_name Like #{team_name}
  	</select>
  	<!-- 유저번호에 팀가입 날짜 넣어주기 -->
  	<update id="updateTeamDate" parameterType="com.fm.www.dto.User">
  		UPDATE user_tb set user_team_date = SYSDATE
		WHERE 1=1 AND user_no = #{user_no}
  	</update>
  	<!-- 유저번호에 팀번호 넣어주기 -->
  	<update id="updateTeamNo" parameterType="com.fm.www.dto.User">
  		UPDATE user_tb set team_no = #{team_no}
		WHERE 1=1 AND user_no = #{user_no}
  	</update>
  	
  	<!-- 유저번호로 팀번호 가져오기 -->
  	<select id="selectTeamNoUserNo" parameterType="com.fm.www.dto.User" resultType="int">
  		select team_no from user_tb
  		WHERE 1=1
  		AND user_no = #{user_no}  	
  	</select>
  	<!-- 팀정보 조회 -->
  	<select id="selectTeamInfoMation" parameterType="com.fm.www.dto.User" resultType="com.fm.www.dto.Team">
  		select * from team_tb
  		WHERE 1=1
  		AND team_no = #{team_no}  	
  	</select>
  	
  	<!-- 팀번호로 팀소속유저들 조회 -->
  	<select id="selectTeamUserList" parameterType="int" resultType="com.fm.www.dto.User">
  		select * from user_tb
  		WHERE 1=1
  		AND team_no = #{team_no}
  		ORDER BY user_no
  	</select>
  	
  	<!-- 유저번호로 유저정보 조회 -->
  	<select id="selectUserInformation" parameterType="int" resultType="com.fm.www.dto.User">
  		SELECT * FROM user_tb
  		WHERE 1=1
  		AND user_no = #{user_no}
  	</select>
  	
  	<!-- //유저번호와 유저비밀번호로 비밀번호가 맞는지 조회 -->
	<select id="checkPw" parameterType="com.fm.www.dto.User" resultType="int">
		SELECT COUNT(*) FROM user_tb
		WHERE 1=1
		AND user_no = #{user_no}
		AND user_pw = #{user_pw}
	</select>
	
	<!-- 유저비밀번호 변경 -->
	<update id="pwChange" parameterType="com.fm.www.dto.User">
		UPDATE user_tb set user_pw = #{user_pw}
		WHERE 1=1 AND user_no = #{user_no}
	</update>
	
	<!-- 유저정보 업데이트 -->
	<update id="updateMemberInfo" parameterType="com.fm.www.dto.User">
		UPDATE user_tb set user_email = #{user_email}, user_phone = #{user_phone}, user_region = #{user_region}
		WHERE 1=1 AND user_no = #{user_no}
	</update>
	
	
	<!-- 내가 쓴 게시글 총 갯수 가져오기 -->
	<select id="getTotalCountSearch" resultType="int">
		SELECT COUNT(*) from board_tb
		WHERE 1=1
		<choose>
         <when test="p2 == '제목'">
		 	AND board_title Like '%' || #{p3} || '%'
		 </when>
		 <when test="p2 == '내용'">
		 	AND board_content Like '%' || #{p3} || '%'
		 </when>
		 </choose>
		AND user_no = #{p1.user_no}
		AND delete_yn = 'N'
	</select>
	
	<!-- 내가 쓴 게시글 리스트 가져오기 -->
	<select id="getPagingListSearch" resultType="com.fm.www.dto.Board_tb">
		SELECT * FROM (
	       SELECT rownum rnum, M.* FROM (
	         SELECT B.*
	          FROM board_tb B
	          WHERE 1=1 
	          <choose>
	          <when test="p3 == '제목'">
			  	AND board_title Like '%' || #{p4} || '%'
			  </when>
			  <when test="p3 == '내용'">
			  	AND board_content Like '%' || #{p4} || '%'
			  </when>
			  </choose>
	          AND user_no = #{p1.user_no}
			  AND delete_yn = 'N'
	          ORDER BY board_no desc
	       ) M
	       ORDER BY rnum
	      ) R
	      WHERE rnum BETWEEN #{p2.startNo} AND #{p2.endNo}
	</select>
	
	<!-- 게시글 댓글수 조회해오기 -->
	<select id="getBoardReplyCnt" resultType="int" parameterType="int">
		select COUNT(*) FROM board_reply
		WHERE board_no = #{board_no}
	</select>
	
	
  </mapper>